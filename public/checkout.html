<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopZone - Checkout</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f1a; color: #fff; }
        body.light { background: #f5f5f5; color: #111; }
        nav { background: linear-gradient(135deg, #6c00ff, #ff006e); padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; }
        nav .logo { font-size: 24px; font-weight: bold; }
        nav a { color: #fff; text-decoration: none; margin-left: 12px; padding: 7px 15px; border-radius: 25px; font-size: 14px; }
        .wrap { max-width: 1000px; margin: 40px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media(max-width:700px) { .wrap { grid-template-columns: 1fr; } }
        .card { background: linear-gradient(135deg, #1e1e3a, #2a1a4a); border: 1px solid #6c00ff44; border-radius: 16px; padding: 30px; }
        body.light .card { background: #fff; border-color: #ddd; }
        .card h3 { font-size: 20px; margin-bottom: 20px; color: #ff9500; }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; color: #aaa; margin-bottom: 7px; font-size: 13px; }
        body.light .form-group label { color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 12px 16px; background: #0f0f1a; border: 1px solid #6c00ff44; border-radius: 10px; color: #fff; font-size: 15px; outline: none; transition: border 0.3s; }
        body.light .form-group input, body.light .form-group select { background: #f5f5f5; color: #111; }
        .form-group input:focus { border-color: #6c00ff; }
        .order-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #6c00ff22; font-size: 14px; }
        .order-item:last-child { border: none; }
        .total-row { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; color: #ff006e; margin-top: 15px; }
        .place-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #6c00ff, #ff006e); border: none; border-radius: 12px; color: #fff; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: opacity 0.2s; }
        .place-btn:hover { opacity: 0.9; }
        .success { text-align: center; padding: 40px; display: none; }
        .success h2 { font-size: 40px; color: #00ff64; margin-bottom: 15px; }
        .success p { color: #aaa; margin-bottom: 20px; }
        .success a { color: #6c00ff; text-decoration: none; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>
<nav>
    <div class="logo">üõçÔ∏è ShopZone</div>
    <div><a href="/">Home</a><a href="/shop">Shop</a><a href="/cart">Cart</a></div>
</nav>
<div id="checkoutWrap" class="wrap">
    <div class="card">
        <h3>üì¶ Shipping Details</h3>
        <div class="form-group"><label>Full Name</label><input id="fullName" placeholder="John Doe" /></div>
        <div class="form-group"><label>Email</label><input id="email" type="email" placeholder="john@email.com" /></div>
        <div class="form-group"><label>Phone</label><input id="phone" placeholder="+1 234 567 890" /></div>
        <div class="form-group"><label>Address</label><input id="address" placeholder="Street address" /></div>
        <div class="form-group"><label>City</label><input id="city" placeholder="City" /></div>
        <div class="form-group"><label>Country</label>
            <select id="country">
                <option>United States</option><option>Nepal</option><option>India</option><option>UK</option><option>Canada</option><option>Australia</option>
            </select>
        </div>
        <h3 style="margin-top:25px">üí≥ Payment</h3>
        <div class="form-group"><label>Card Number</label><input id="cardNum" placeholder="1234 5678 9012 3456" maxlength="19" /></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
            <div class="form-group"><label>Expiry</label><input id="expiry" placeholder="MM/YY" maxlength="5" /></div>
            <div class="form-group"><label>CVV</label><input id="cvv" placeholder="123" maxlength="3" type="password" /></div>
        </div>
    </div>
    <div class="card">
        <h3>üõí Order Summary</h3>
        <div id="orderItems"></div>
        <div class="total-row"><span>Total</span><span id="orderTotal"></span></div>
        <button class="place-btn" onclick="placeOrder()">üöÄ Place Order</button>
    </div>
</div>
<div class="success" id="successMsg">
    <p style="font-size:70px">üéâ</p>
    <h2>Order Placed!</h2>
    <p>Thank you! Your order has been placed successfully.</p>
    <p style="color:#ff9500;margin-bottom:20px" id="orderId"></p>
    <a href="/orders">View My Orders</a> &nbsp;&nbsp; <a href="/shop">Continue Shopping</a>
</div>
<script>
    if (localStorage.getItem("theme") === "light") document.body.classList.add("light")
    const cart = JSON.parse(localStorage.getItem("cart")) || []
    const user = JSON.parse(localStorage.getItem("shopUser"))

    if (user) { document.getElementById("fullName").value = user.name; document.getElementById("email").value = user.email; }

    const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0)
    const shipping = subtotal > 100 ? 0 : 10
    const total = subtotal + shipping

    document.getElementById("orderItems").innerHTML = cart.map(i => `<div class="order-item"><span>${i.name} x${i.qty}</span><span>$${(i.price * i.qty).toFixed(2)}</span></div>`).join("") +
        `<div class="order-item"><span>Shipping</span><span>${shipping === 0 ? "FREE" : "$" + shipping}</span></div>`
    document.getElementById("orderTotal").textContent = "$" + total.toFixed(2)

    async function placeOrder() {
        const fullName = document.getElementById("fullName").value
        const address = `${document.getElementById("address").value}, ${document.getElementById("city").value}, ${document.getElementById("country").value}`
        if (!fullName || !document.getElementById("address").value) { alert("Please fill shipping details!"); return }
        if (cart.length === 0) { alert("Your cart is empty!"); return }
        const res = await fetch("/api/orders/place", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId: user ? user.id : "guest", userName: fullName, items: cart, total: total.toFixed(2), address })
        })
        const data = await res.json()
        if (data.success) {
            localStorage.removeItem("cart")
            document.getElementById("checkoutWrap").style.display = "none"
            document.getElementById("successMsg").style.display = "block"
            document.getElementById("orderId").textContent = "Order ID: #" + data.order.id
        }
    }
</script>
</body>
</html>